<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会话调试页面</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .btn-group {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>会话调试工具</h1>
        
        <div class="mb-4">
            <div class="btn-group" role="group">
                <button id="check-session" class="btn btn-primary">检查会话状态</button>
                <button id="set-test-session" class="btn btn-success">设置测试会话</button>
                <button id="direct-dashboard" class="btn btn-warning">直接进入仪表盘</button>
                <button id="clear-cookies" class="btn btn-danger">清除全部Cookie</button>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        会话状态
                    </div>
                    <div class="card-body">
                        <pre id="session-info">点击"检查会话状态"按钮获取信息</pre>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        浏览器Cookie
                    </div>
                    <div class="card-body">
                        <pre id="cookies-info">点击"检查会话状态"按钮获取信息</pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                页面链接
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a href="/auth/login.html" class="list-group-item list-group-item-action">登录页面</a>
                    <a href="/auth/register.html" class="list-group-item list-group-item-action">注册页面</a>
                    <a href="/auth/dashboard.html" class="list-group-item list-group-item-action">仪表盘</a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 获取所有Cookie并展示
        function updateCookiesInfo() {
            const cookiesElement = document.getElementById('cookies-info');
            const cookies = document.cookie.split(';').map(cookie => cookie.trim());
            
            if (cookies.length === 1 && cookies[0] === "") {
                cookiesElement.textContent = "没有Cookie";
                return;
            }
            
            const cookiesObj = {};
            cookies.forEach(cookie => {
                const [name, value] = cookie.split('=');
                if (name) cookiesObj[name] = value;
            });
            
            cookiesElement.textContent = JSON.stringify(cookiesObj, null, 2);
        }
        
        // 检查会话状态
        document.getElementById('check-session').addEventListener('click', function() {
            fetch('/auth/debug/session')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('session-info').textContent = JSON.stringify(data, null, 2);
                    updateCookiesInfo();
                })
                .catch(error => {
                    document.getElementById('session-info').textContent = '获取会话信息出错: ' + error.message;
                });
        });
        
        // 设置测试会话
        document.getElementById('set-test-session').addEventListener('click', function() {
            const testValue = 'test_' + Date.now();
            fetch(`/auth/debug/set_session?value=${testValue}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('session-info').textContent = JSON.stringify(data, null, 2);
                    updateCookiesInfo();
                    alert('测试会话已设置，值为: ' + testValue);
                })
                .catch(error => {
                    document.getElementById('session-info').textContent = '设置测试会话出错: ' + error.message;
                });
        });
        
        // 直接进入仪表盘
        document.getElementById('direct-dashboard').addEventListener('click', function() {
            window.location.href = '/auth/debug/direct_dashboard';
        });
        
        // 清除全部Cookie
        document.getElementById('clear-cookies').addEventListener('click', function() {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i];
                const eqPos = cookie.indexOf("=");
                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
            }
            updateCookiesInfo();
            alert('已清除全部Cookie');
        });
        
        // 初始更新
        updateCookiesInfo();
    </script>
</body>
</html>